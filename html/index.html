<!DOCTYPE HTML>
<html>
  <head>
    <base href="/stats/">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <link rel="stylesheet" href="static/style.css">
    <link rel="shortcut icon" type="image/x-icon" href="static/favicon.png">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400">
    <title>Stats2</title>
  </head>
  <body>
    <a class="title" href="/stats">Stats<sup class="red">2</sup></a>
    <ul>
      <li>Total workflows in Stats<sup class="red">2</sup>: {{ total_workflows }}</li>
      <li><a href="http://instance3.cern.ch/jenkins/job/Stats2%20Update/lastBuild/">Last Jenkins job</a></li>
      <li><a href="https://github.com/justinasr/Stats2">GitHub</a></li>
      <li>Update time:<a href="http://instance3.cern.ch/jenkins/job/Stats2%20Update/buildTimeTrend"><br><img style="width:180px" src="http://instance3.cern.ch/jenkins/job/Stats2%20Update/buildTimeGraph/png"/></a></li>
    </ul>
    <table class="table" style="font-size: 0.9rem">
      <tr style="font-size: 14px">
        <th>Workflow</th>
        <th>McM Requests/Campaigns</th>
        <th>Output datasets</th>
      </tr>
      {% for workflow in workflows %}
        <tr>
          <td><small>Name</small>: <b><a href="0?workflow_name={{ workflow.RequestName }}">{{ workflow.RequestName }}</a></b><br>
              {% if workflow.PrepID | length > 0 %}
                <small>PrepID</small>: <b><a href="0?prepid={{ workflow.PrepID }}">{{ workflow.PrepID }}</a></b><br>
              {% endif %}
              <small>Type</small>: <b><a href="0?type={{ workflow.RequestType }}">{{ workflow.RequestType }}</a></b><br>
              <small>Total events</small>: <b>{{ workflow.TotalEvents }}</b><br>
              <small>Priority</small>: <b>{{ workflow.RequestPriority }}</b><br>
              <small>Last update (<a href="update/{{ workflow._id }}">Update&nbsp;Now</a>)</small>: <b>{{ workflow.LastUpdate | safe }}</b><br>
              {% if workflow.Submitted | length > 0 %}
                <small>Submitted</small>: <b>{{ workflow.Submitted | safe }}</b><br>
              {% endif %}
              {% if workflow.LastStatus | length > 0 %}
                <small>Last status</small>: <b>{{ workflow.LastStatus | safe }}</b><br>
              {% endif %}
              {% if workflow.ProcessingString | length > 0 %}
                  <small>Processing string</small>: <b><a href="0?processing_string={{ workflow.ProcessingString }}">{{ workflow.ProcessingString }}</a></b><br>
              {% endif %}
              <small><a href="https://cmsweb.cern.ch/reqmgr2/data/request?name={{ workflow.RequestName }}">ReqMgr2</a></small><br>
              <small><a href="get_json/{{ workflow._id }}">View&nbsp;JSON</a></small><br>
          </td>
          <td>
            <ul>
              <li>Requests (Tasks/Steps):
                <ul>
                  {% for request in workflow.Requests %}
                    <li>
                      <small><a href="0?request={{ request }}">{{ request }}</a></small>
                      <b><a href="https://cms-pdmv.cern.ch/mcm/requests?prepid={{ request }}">McM</a></b>
                      <a href="https://cms-pdmv.cern.ch/pmp/historical?r={{ request }}">pMp</a>
                    </li>
                  {% endfor %}
                </ul>
              </li>
              <li>Campaigns:
                <ul>
                  {% for campaign in workflow.Campaigns %}
                    <li>
                      <small><a href="0?campaign={{ campaign }}">{{ campaign }}</a></small>
                      <b><a href="https://cms-pdmv.cern.ch/mcm/requests?prepid={{ campaign }}">McM</a></b>
                      <a href="https://cms-pdmv.cern.ch/pmp/historical?r={{ campaign }}">pMp</a>
                    </li>
                  {% endfor %}
                </ul>
              </li>
            </ul>
          </td>
          <td>
            <ul>
              {% for dataset in workflow.OutputDatasets %}
                <li>
                  <div title="{{ dataset.Type }}, {{ dataset.CompletedPerc }}%" class="gray-bar">
                    {% if dataset.Type == 'VALID' %}
                      <div title="{{ dataset.Type }}, {{ dataset.CompletedPerc }}%" style="width: {{ dataset.CompletedPerc }}%;" class="bar valid-bar"></div>
                    {% elif dataset.Type == 'PRODUCTION' %}
                      <div title="{{ dataset.Type }}, {{ dataset.CompletedPerc }}%" style="width: {{ dataset.CompletedPerc }}%;" class="bar production-bar"></div>
                    {% elif dataset.Type == 'INVALID' %}
                      <div title="{{ dataset.Type }}, {{ dataset.CompletedPerc }}%" style="width: {{ dataset.CompletedPerc }}%;" class="bar invalid-bar"></div>
                    {% elif dataset.Type == 'DELETED' %}
                      <div title="{{ dataset.Type }}, {{ dataset.CompletedPerc }}%" style="width: {{ dataset.CompletedPerc }}%;" class="bar deleted-bar"></div>
                    {% else %}
                      <div title="{{ dataset.Type }}, {{ dataset.CompletedPerc }}%" style="width: {{ dataset.CompletedPerc }}%;" class="bar"></div>
                    {% endif %}
                  </div>
                    <small>datatier:</small> <b>{{dataset.Datatier}}</b>,
                    <small>completed:</small> <b>{{dataset.CompletedPerc}}%</b>,
                    <small>events:</small> <b>{{dataset.Events}}</b>,
                    <small>type:</small> <b>{{dataset.Type}}</b>,
                    <b><a href="https://cmsweb.cern.ch/das/request?view=list&limit=50&instance=prod%2Fglobal&input=dataset%3D{{ dataset.Name }}">DAS</a></b><br>
                    <small><a href="0?dataset={{ dataset.Name }}">{{ dataset.Name }}</a></small>
                </li>
              {% endfor %}
            </ul>
          </td>
        </tr>
      {% endfor %}
    </table>
    <div class="footer">
      <ul class="pagination justify-content-center">
        <li class="page-item {% if not pages[1] %}disabled{% endif %}"><a class="page-link" href="{{ pages[0] - 1 }}?{{ query }}">Previous</a></li>
        <li class="page-item"><a class="page-link" href="#">{{ pages[0] }}</a></li>
        <li class="page-item {% if not pages[2] %}disabled{% endif %}"><a class="page-link" href="{{ pages[0] + 1 }}?{{ query }}">Next</a></li>
      </ul>
    </div>
  </body>
</html>
